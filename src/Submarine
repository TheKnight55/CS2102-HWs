import java.util.List;

public class Submarine implements Vehicle {
    /**
     * the name of the submarine's captain
     */
    public String captain;
    /**
     * number of tail fins the submarine has (current drawn by fins: 1.5mA)
     */
    public int tailFins;
    /**
     * information about the submarine's propulsors
     */
    public Propulsors propulsors;
    /**
     * information about the submarine's main battery
     */
    public Battery battery;
    /** how many meters beneath the surface left to go */
    public double metersBelowDest;

    /**
     * The constructor for a submarine with no default assumptions
     * @param captain name of captain
     * @param tailFins # tail fins
     * @param propulsors info about propulsors
     * @param battery info about battery
     * @param metersBelowDest # meters left to go until the destination is reached
     */
    public Submarine(String captain, int tailFins, Propulsors propulsors, Battery battery, double metersBelowDest) {
        this.captain = captain;
        this.tailFins = tailFins;
        this.propulsors = propulsors;
        this.battery = battery;
        this.metersBelowDest = metersBelowDest;
    }

    /**
     *
     * @return
     */
    @Override
    public String identifier() {
        return this.captain + String.format("(%d)", this.tailFins);
    }

    /**
     * Calculates the total current drawn by the submarine
     * @return the current in mA as a double >=0
     */
    protected double findCurrentDrawn() {
        return (this.tailFins*1.5 + this.propulsors.totalCurrent());
    }

    /**
     * computes the ratio of meters travelable on its current battery’s amount left to meters until its destination.
     * If the vehicle can go past its destination, the method should produce 1.0.
     * @return the ratio
     */
    @Override
    public double percentUntilRecharge() {
        double currentDraw = findCurrentDrawn();
        double seconds = this.battery.secondsOnLeft(currentDraw);
        double altitudeTravelable = seconds*propulsors.findAcceleration(seconds);
        double percentUntilRecharge = altitudeTravelable / this.metersBelowDest;
        if(percentUntilRecharge >= 1){
            return 1.0;
        } else {
            return percentUntilRecharge;
        }
    }
    /**
     * Determines whether the submarine can reach the destination on its current battery’s amount left.
     * @return true if can reach dest, false if not
     */
    @Override
    public boolean doesReachDest() {
        return this.percentUntilRecharge() == 1.0;
    }

    /**
     * Produces the number of meters the submarine can travel on a full battery
     * @return meters (must be >= 0)
     */
    @Override
    public double metersOnFull() {
        double currentDraw = findCurrentDrawn();
        double seconds = this.battery.secondsOnFull(currentDraw);
        double altitudeTravelable = seconds*propulsors.findAcceleration(seconds);
        return altitudeTravelable;
    }

    /**
     * Travels for the given number of seconds at the speed of its propulsers, moving the vehicle closer to its
     * destination and using its current amount of battery.
     * If the vehicle goes past its destination, metersToDest = 0, and if it needs more battery than is available
     * amountLeft = 0
     * @param seconds number of seconds given
     */
    @Override
    public void runFor(double seconds) {
        double currentDraw = findCurrentDrawn();
        double altitudeTravelable = seconds*propulsors.findAcceleration(seconds);
        this.metersBelowDest -= altitudeTravelable;
        if(this.metersBelowDest < 0.0){
            this.metersBelowDest = 0.0;
        }
        double currentSeconds = currentDraw * seconds;
        this.battery.reduceBy(currentSeconds);
    }
    /**
     * Compares the two objects to determine if they're the same Competition
     * @param o the reference object with which to compare.
     * @return true or false
     */
    @Override
    public boolean equals(Object o) {
        if(o instanceof Submarine sub){
            return sub.captain.equals(captain) && sub.tailFins==tailFins && sub.propulsors.equals(propulsors)
                    && sub.battery.equals(battery) && Math.abs(sub.metersBelowDest-metersBelowDest)<0.01;
        }
        return false;
    }

    /**
     * Prints out the information about the submarine
     * @return a String containing the captain, tailFins, propulsors, and battery of the submarine in the format "Captain: %s, %s fins, %s, %s
     */
    @Override
    public String toString(){
        return String.format("Captain %s, %s fins, %s, %s, %s", this.captain, this.tailFins, this.propulsors, this.battery, metersBelowDest);
    }
}
